<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>QRCode Model 2</title>
</head>

<body style="text-align: center;padding-top:100px;background-color:#F6F6F6">

<canvas id="canvas"></canvas>

<script src="src/Utils.js"></script>
<script src="src/QrCode/Config.js"></script>
<script src="src/QrCode/GeneratorPolynominal.js"></script>
<script src="src/QrCode/DataAnalyzer.js"></script>
<script src="src/QrCode/DataEncoder.js"></script>
<script src="src/QrCode/ErrorCorrection.js"></script>
<script src="src/QrCode/Matrix.js"></script>
<script src="src/QrCode/Tiler.js"></script>
<script src="src/QrCode/Mask.js"></script>
<script src="src/QrCode/Evaluation.js"></script>
<script src="src/QrCode/QrCode.js"></script>

<script>

    var data = 'HELLO WORLD';
    var ecstrategy = ['L'];
    var modulesize = 5;
    var quietZoneSize = 4;

    ecstrategy = ['Q'];
    data = 'There\\\'s a frood who really knows where his towel is!';

    ecstrategy = ['L'];
    data = "And now, the end is near\nAnd so I face the final curtain\nMy friend, I'll say it clear\nI'll state my case, of which I'm certain\nI've...";

    /**
     * HTTP HttpRequest support
     * @constructor
     */
    var HttpRequest = function () {
        this.href = location.href;
        this.host = this.href.split('?').shift();
        this.query = this.href.split('?').pop();
        this.params = this.getParams();
    };

    HttpRequest.prototype.constructor = HttpRequest;

    HttpRequest.prototype.getParams = function () {
        var params = {};
        if (location.search) {
            var parts = location.search.slice(1).split('&');
            parts.forEach(function (part) {
                var pair = part.split('=');
                pair[0] = decodeURIComponent(pair[0]);
                pair[1] = decodeURIComponent(pair[1]);
                params[pair[0]] = (pair[1] !== 'undefined') ? pair[1] : true;
            });
        }

        return params;
    };

    function draw(code, blocksize, quietZoneSize) {

        blocksize = blocksize || 4;
        quietZoneSize = quietZoneSize || 4;

        var colors = {};
        colors[code.matrix.DATA_DARK_MODULE] = '#000000';
        colors[code.matrix.DATA_LIGHT_MODULE] = '#FFFFFF';
        colors[code.matrix.DATA_UNDEFINED_MODULE] = '#CCCCCC';

        var quietZone = quietZoneSize * blocksize;
        var size = code.getSize() * blocksize + 2 * quietZone;
        var grid = code.getData();

        var canvas = document.getElementById('canvas');
        canvas.setAttribute('width', size);
        canvas.setAttribute('height', size);

        var context = canvas.getContext('2d');
        context.beginPath();
        context.fillStyle = colors[code.matrix.DATA_LIGHT_MODULE];
        context.rect(0, 0, size, size);
        context.fill();

        for (var top = 0; top < grid.length; top++) {
            for (var left = 0; left < grid[0].length; left++) {
                context.beginPath();
                context.fillStyle = colors[grid[top][left]];
                context.rect(quietZone + left * blocksize, quietZone + top * blocksize, blocksize, blocksize);
                context.fill();
            }
        }
    }

    var request = new HttpRequest();

    if (request.params.hasOwnProperty('data')) {
        data = request.params['data'];
    }

    if (request.params.hasOwnProperty('ec')) {
        ecstrategy = [request.params['ec']];
    }

    if (request.params.hasOwnProperty('size')) {
        var temp = parseInt(request.params['size']);
        modulesize = !isNaN(temp) && temp > 0 ? temp : modulesize;
    }

    var qrcode = new QrCode(data, ecstrategy);

    draw(qrcode, modulesize, quietZoneSize);

    console.log(qrcode.getInfo());

</script>

</body>
</html>