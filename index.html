<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>QR Code Model 2</title>

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css"/>

    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto+Slab|Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic&subset=latin-ext);

        body {
            background-color: #FFFFFF;
            font-family: 'Open Sans', sans-serif;
            font-weight: 400;
        }

        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
            color: #555555 !important;
            font-family: 'Roboto Slab', serif;
            line-height: 1.3;
        }

        .navbar-brand {
            font-family: 'Roboto Slab', serif;
        }

        #canvas {
            image-rendering: -moz-crisp-edges; /* FF 6.0+ */
            image-rendering: -webkit-optimize-contrast; /* Webkit */
            /*  (Safari now, Chrome soon) */
            image-rendering: -o-crisp-edges; /* OS X & Windows Opera (12.02+) */
            image-rendering: optimize-contrast; /* Possible future browsers. */
            -ms-interpolation-mode: nearest-neighbor; /* IE */
        }

        .canvas {
            text-align: center;
            padding-top: 32px;
            padding-bottom: 32px;
            background-color: #EEEEEE;
            border: 1px solid #CCCCCC;
            border-radius: 4px;
        }

        .page-header {
            margin-top: 0;
        }

        form.form-horizontal textarea {
            resize: vertical;
        }

        form.form-horizontal .input-group label {
            min-width: 130px;
            text-align: right;
            vertical-align: top;
            padding-top: 9px;
        }

        form.form-horizontal .input-group {
            margin-bottom: 8px;
        }

        .info.list-group {
            box-shadow: none;
        }

        .info .list-group-item {
            display: table-row;
        }

        .info div {
            display: table-cell;
            padding-bottom: 8px;
        }

        .info div.label {
            color: #555555 !important;
            font-size: 1em;
            text-align: right;
            margin-right: 4px
        }

        .info div.data {
            white-space: pre-wrap;
            word-break: break-all;
        }

        .info div.label:after {
            content: ':'
        }

    </style>
</head>

<body>

<div id="wrap">
    <div class="navbar navbar-default navbar-static-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">
                    <i class="icon-qrcode"></i>
                    QR Code Model 2
                </a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a title="References" class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <i class="icon-book icon-large"></i>
                            References
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="dropdown-header">Inventor’s Page</li>
                            <li><a target="_blank" href="http://www.qrcode.com/en/">QRcode.com｜DENSO WAVE</a></li>
                            <li class="divider"></li>
                            <li class="dropdown-header">Info</li>
                            <li><a target="_blank" href="http://en.wikipedia.org/wiki/QR_code">QR code - Wikipedia, the free encyclopedia</a></li>
                            <li class="divider"></li>
                            <li class="dropdown-header">Tutorials</li>
                            <li><a target="_blank" href="http://www.thonky.com/qr-code-tutorial/">QR Code Tutorial</a></li>
                            <li><a target="_blank" href="http://www.swetake.com/qrcode/index-e.html">QRCode (Tutorial and demo)</a></li>
                            <li class="divider"></li>
                            <li class="dropdown-header">QR Code Desktop Reader</li>
                            <li><a target="_blank" href="http://www.codetwo.pl/freeware/qr-code-desktop-reader/">CodeTwo QR Code Desktop Reader</a>
                            <li class="dropdown-header">QR Code Commandline Decoder</li>
                            <li><a target="_blank" href="http://zbar.sourceforge.net/">ZBar bar code reader</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a target="_blank" title="Tests" href="qunit/index.src.html">
                            <i class="icon-wrench icon-large"></i>
                            Tests
                        </a>
                    </li>
                    <li>
                        <a target="_blank" title="GitHub" href="https://github.com/siciarek/javascript-qrcode">
                            <i class="icon-github icon-large"></i>
                            Source on GitHub
                        </a>
                    </li>
                    <li>
                        <a target="_blank" title="NPM" href="https://www.npmjs.org/package/javascript-qrcode">
                            <i class="icon-info-sign icon-large"></i>
                            Module on NPM
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container">

        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                    <h1>
                        <i class="icon-qrcode text-muted"></i>
                        QR Code Model 2
                    </h1>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <form class="form-horizontal qrcode-form">

                    <div class="input-group">
                        <label class="input-group-addon" for="data">Data</label>
                        <textarea name="data" id="data" class="form-control" rows="5" placeholder="Insert textual data"></textarea>
                    </div>

                    <span class="help-block data"></span>

                    <div class="input-group">
                        <label class="input-group-addon" for="ec">Error Correction</label>
                        <select name="ec" id="ec" class="form-control">
                            <option title="Level L (Low) ~7% of codewords can be restored." value="L">Level L (Low) ~7% of codewords can be
                                restored.
                            </option>
                            <option title="Level M (Medium) ~15% of codewords can be restored." value="M" selected="selected">Level M (Medium) ~15% of
                                codewords can be restored.
                            </option>
                            <option title="Level Q (Quartile) ~25% of codewords can be restored." value="Q">Level Q (Quartile) ~25% of codewords can
                                be restored.
                            </option>
                            <option title="Level H (High) ~30% of codewords can be restored." value="H">Level H (High) ~30% of codewords can be
                                restored.
                            </option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="input-group-addon" for="version">Version</label>
                        <select name="version" id="version" class="form-control">
                            <option value="0" selected="selected">Auto</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="input-group-addon" for="version">Mask Pattern</label>
                        <select name="mask" id="mask" class="form-control">
                            <option value="" selected="selected">Auto</option>
                            <option value="-1">Raw Data</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="input-group-addon" for="size">Module Size</label>
                        <select name="size" id="size" class="form-control">
                            <option value="2">Small</option>
                            <option value="3" selected="selected">Medium</option>
                            <option value="5">Large</option>
                        </select>
                    </div>

                    <br/>

                    <a href="javascript:void(null)" id="generate-qrcode" class="btn btn-default btn-lg pull-right  hidden">
                        <i class="icon-cog text-muted"></i>
                        Generate
                    </a>

                    <div class="clearfix"></div>
                    <br/>
                    <br/>
                </form>
            </div>
            <div class="col-md-6">

                <div class="canvas center">
                    <canvas id="canvas"></canvas>
                </div>

                <div>
                    <h3>
                        <i class="icon-info-sign text-muted"></i>
                        Info
                    </h3>

                    <div id="info"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="//code.jquery.com/jquery.js"></script>
<script src="//cdn.jsdelivr.net/jquery.cookie/1.3.1/jquery.cookie.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<script src="src/Utils.js"></script>
<script src="src/QrCode/Exceptions.js"></script>
<script src="src/QrCode/GeneratorPolynominal.js"></script>
<script src="src/QrCode/Config.js"></script>
<script src="src/QrCode/ErrorCorrection.js"></script>
<script src="src/QrCode/DataEncoder.js"></script>
<script src="src/QrCode/DataAnalyzer.js"></script>
<script src="src/QrCode/Matrix.js"></script>
<script src="src/QrCode/Tiler.js"></script>
<script src="src/QrCode/Matrix.js"></script>
<script src="src/QrCode/Mask.js"></script>
<script src="src/QrCode/Evaluation.js"></script>
<script src="src/QrCode/QrCode.js"></script>

<script>

    var modulesize = 3;
    var quietZoneSize = 4;
    var maskPattern = null;
    var maskTest = false;
    var version = null;
    var data = '$, ¢, €, 𤭢 - Pchnąć w tę łódź jeża lub ośm skrzyń fig.';

    var ecstrategy = ['M'];

    /**
     * HTTP HttpRequest support
     * @constructor
     */
    var HttpRequest = function () {
        this.href = location.href;
        this.host = this.href.split('?').shift();
        this.query = this.href.split('?').pop();
        this.params = this.getParams();
    };

    HttpRequest.prototype.constructor = HttpRequest;

    HttpRequest.prototype.getParams = function () {
        var params = {};
        if (location.search) {
            var parts = location.search.slice(1).split('&');
            parts.forEach(function (part) {
                var pair = part.split('=');
                pair[0] = decodeURIComponent(pair[0]);
                pair[1] = decodeURIComponent(pair[1]);
                params[pair[0]] = (pair[1] !== 'undefined') ? pair[1] : true;
            });
        }

        return params;
    };

    function setInfo(info) {

        var size = 4 * (info.version - 1) + 21;

        info.size = size + ' &times; ' + size;

        var fields = {
            version: 'Version',
            size: 'Size',
            mode: 'Mode',
            eclevel: 'Error Correction',
            pattern: 'Mask Pattern',
            capacity: 'Max Capacity',
            charcount: 'Character Count',
            datalen: 'Data Size',
            data: 'Data'
        };

        var html = '';

        html += '<ul class="list-group info">';
        for (var key in fields) {
            if (fields.hasOwnProperty(key) && info.hasOwnProperty(key)) {
                var value = info[key];
                var field = fields[key];

                if (key === 'eclevel') {
                    value = $('select[name="ec"]').find('option[value="' + value + '"]').text();
                }
                else if (key === 'datalen') {
                    value += ' B';
                }

                html += '<li class="list-group-item"><div class="label">' + field + '</div><div class="' + key + '">' + value + '</div></li>';
            }
        }
        html += '</ul>';

        $('#info').html(html);
    }

    function draw(code, blocksize, quietZoneSize) {

        blocksize = blocksize || 4;
        quietZoneSize = quietZoneSize || 4;

        var colors = {};
        colors[code.matrix.DATA_DARK_MODULE] = '#000000';
        colors[code.matrix.DATA_LIGHT_MODULE] = '#FFFFFF';
        colors[code.matrix.DATA_UNDEFINED_MODULE] = '#CCCCCC';

        var quietZone = quietZoneSize * blocksize;
        var size = code.getSize() * blocksize + 2 * quietZone;
        var grid = code.getData();

        var canvas = document.getElementById('canvas');
        canvas.setAttribute('width', size);
        canvas.setAttribute('height', size);

        var context = canvas.getContext('2d');
        context.beginPath();
        context.fillStyle = colors[code.matrix.DATA_LIGHT_MODULE];
        context.rect(0, 0, size, size);
        context.fill();

        for (var top = 0; top < grid.length; top++) {
            for (var left = 0; left < grid[0].length; left++) {
                if (grid[top][left] !== 0) {
                    context.beginPath();
                    context.fillStyle = colors[grid[top][left]];
                    context.rect(quietZone + left * blocksize, quietZone + top * blocksize, blocksize, blocksize);
                    context.fill();
                }
            }
        }
    }

    var request = new HttpRequest();

    if (request.params.hasOwnProperty('data')) {
        data = request.params['data'];
    }

    if (request.params.hasOwnProperty('ec')) {
        ecstrategy = [request.params['ec']];
    }

    if (request.params.hasOwnProperty('mp')) {
        maskPattern = request.params['mp'];
    }

    if (request.params.hasOwnProperty('mt')) {
        maskTest = request.params['mt'] == 1;
    }

    if (request.params.hasOwnProperty('version')) {
        version = request.params['version'];
    }

    if (request.params.hasOwnProperty('size')) {
        var temp = parseInt(request.params['size']);
        modulesize = !isNaN(temp) && temp > 0 ? temp : modulesize;
    }

    function run(data, ecstrategy, maskPattern, version, modulesize, quietZoneSize, dataOnly) {
        dataOnly = dataOnly || false;

        try {
            var qrcode = new QrCode(data, ecstrategy, maskPattern, version, dataOnly, maskTest);
            draw(qrcode, modulesize, quietZoneSize);

            var info = qrcode.getInfo();
            info.charcount = data.length;
            setInfo(qrcode.getInfo());
        }
        catch (e) {
            $('.qrcode-form .help-block.data').html(e);
        }
    }

    run(data, ecstrategy, maskPattern, version, modulesize, quietZoneSize, false);

</script>

<script>

    function clearCanvas(context, canvas) {
        context.clearRect(0, 0, canvas.width, canvas.height);
        var w = canvas.width;
        canvas.width = 1;
        canvas.width = w;
    }

    $(document).ready(function () {

        var o;

        $('.qrcode-form textarea').val(data);

        for (o = 1; o <= 40; o++) {
            $('.qrcode-form select[name="version"]').append('<option value="' + o + '">' + o + '</option>');
        }

        for (o = 0; o < 8; o++) {
            $('.qrcode-form select[name="mask"]').append('<option value="' + o + '">' + o + '</option>');
        }

        $('.qrcode-form')
                .on('change', 'select', function () {
                    var self = $(this);

                    if (self.attr('name') === 'version') {
                        if (self.val() > 35) {
                            $('#size').val(2);
                        } else {
                            $('#size').val(3);
                        }
                    }

                    $('#generate-qrcode').trigger('click');
                })
                .on('keyup', 'textarea', function () {

                    var border = {
                        ok: {
                            'border-color': '#66AFE9',
                            'box-shadow': '0 1px 1px rgba(0, 0, 0, 0.075) inset, 0 0 8px rgba(102, 175, 233, 0.6)'
                        },
                        notok: {
                            'border-color': '#FF7777',
                            'box-shadow': '0 1px 1px rgba(0, 0, 0, 0.075) inset, 0 0 8px rgba(233, 175, 102, 0.6)'
                        }
                    };

                    var br = 'notok';

                    if($(this).val().length > 0) {
                        br = 'ok';
                        $('.qrcode-form .help-block.data').html('');
                    }
                    else {
                        $('.info .list-group-item div.data').html('<em class="text-muted">empty</em>');
                        $('.info .list-group-item div.charcount').html('<em class="text-muted">0</em>');
                        $('.info .list-group-item div.datalen').html('<em class="text-muted">0 B</em>');
                    }

                    $('.form-control:focus').css(border[br]);

                    $('#generate-qrcode').trigger('click');
                });

        $('#generate-qrcode').click(function () {
            var quietZoneSize = 4;
            var maskPattern = null;
            var dataOnly = false;

            var mask = $('.form-horizontal *[name="mask"]').val();

            mask = parseInt(mask);

            if (!isNaN(mask) && mask >= 0 && mask < 8) {
                maskPattern = parseInt(mask);
            }
            else if (isNaN(mask)) {
                maskPattern = null;
            }
            else if (mask < 0) {
                dataOnly = true;
            }

            var data = $('.form-horizontal *[name="data"]').val();
            var ec = $('.form-horizontal *[name="ec"]').val();
            var version = $('.form-horizontal *[name="version"]').val();
            version = version == 0 ? null : version;
            var modulesize = $('.form-horizontal *[name="size"]').val();

            var ecstrategy = [ec];

            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            context.webkitImageSmoothingEnabled = false;

            clearCanvas(context, canvas);

            run(data, ecstrategy, maskPattern, version, modulesize, quietZoneSize, dataOnly);
        });
    });
</script>

</body>
</html>